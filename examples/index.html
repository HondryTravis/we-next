<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wangEditor example</title>
    <style>
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/19.7.0/i18next.min.js"
        integrity="sha512-n4K5cTN3agoN7ex8/UyiV83vJsVApziWHYEAaDIJ71o59tHYcYkddYzg55x/6LPs1R5db+f5pE6RmpO45L0pHA=="
        crossorigin="anonymous"></script>
</head>

<body>
    <p>
        wangEditor demo
    </p>
    <div id="div1">
        <p>æ¬¢è¿ä½¿ç”¨ <b>wangEditor</b> å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</p>
        <p>
            <img src="//www.baidu.com/img/flexible/logo/pc/result@2.png" />
        </p>
    </div>

    <button onclick="setHtml('<div>è®¾ç½®çš„å†…å®¹</div>')">è®¾ç½®å†…å®¹</button>
    <button onclick="setText('è®¾ç½®çš„æ–‡æœ¬')">è®¾ç½®æ–‡æœ¬</button>
    <button onclick="appendT()">è¿½åŠ å†…å®¹</button>
    <button onclick="clear()">æ¸…ç©º</button>

    <script src="../dist/wangEditor.js"></script>
    <script>

        (function () {
            console.log('i18next', window.i18next)
        })()

        const E = window.wangEditor
        const editor = new E('#div1')

        const { $ } = E
        const { BtnMenu, DropListMenu, PanelMenu, DropList, Panel, Tooltip } = E.menuConstructors

        // ç¬¬ä¸€ï¼Œèœå• class ï¼ŒButton èœå•ç»§æ‰¿ BtnMenu class
        class AlertMenu extends BtnMenu {
            constructor(editor) {
                const $elem = E.$(
                    `<div class="w-e-menu">
                <button>alert</button>
            </div>`
                )
                super($elem, editor)
            }
            // èœå•ç‚¹å‡»äº‹ä»¶
            clickHandler() {
                // åšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…
                // å¯å‚è€ƒã€å¸¸ç”¨ APIã€‘æ–‡æ¡£ï¼Œæ¥æ“ä½œç¼–è¾‘å™¨

                alert('hello world')
            }
            // èœå•æ˜¯å¦è¢«æ¿€æ´»ï¼ˆå¦‚æœä¸éœ€è¦ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç©ºç€ï¼‰
            // 1. æ¿€æ´»æ˜¯ä»€ä¹ˆï¼Ÿå…‰æ ‡æ”¾åœ¨ä¸€æ®µåŠ ç²—ã€ä¸‹åˆ’çº¿çš„æ–‡æœ¬æ—¶ï¼Œèœå•æ é‡Œçš„ B å’Œ U è¢«æ¿€æ´»ï¼Œå¦‚ä¸‹å›¾
            // 2. ä»€ä¹ˆæ—¶å€™æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Ÿæ¯æ¬¡ç¼–è¾‘å™¨åŒºåŸŸçš„é€‰åŒºå˜åŒ–ï¼ˆå¦‚é¼ æ ‡æ“ä½œã€é”®ç›˜æ“ä½œç­‰ï¼‰ï¼Œéƒ½ä¼šè§¦å‘å„ä¸ªèœå•çš„ tryChangeActive å‡½æ•°ï¼Œé‡æ–°è®¡ç®—èœå•çš„æ¿€æ´»çŠ¶æ€
            tryChangeActive() {
                // æ¿€æ´»èœå•
                // 1. èœå• DOM èŠ‚ç‚¹ä¼šå¢åŠ ä¸€ä¸ª .w-e-active çš„ css class
                // 2. this.this.isActive === true
                this.active()

                // // å–æ¶ˆæ¿€æ´»èœå•
                // // 1. èœå• DOM èŠ‚ç‚¹ä¼šåˆ æ‰ .w-e-active
                // // 2. this.this.isActive === false
                // this.unActive()
            }
        }


        // æ³¨å†Œèœå•
        const menuKey = 'alertMenuKey' // èœå• key ï¼Œå„ä¸ªèœå•ä¸èƒ½é‡å¤
        editor.menus.extend('alertMenuKey', AlertMenu)

        // å°†èœå•åŠ å…¥åˆ° editor.config.menus ä¸­
        // ä¹Ÿå¯ä»¥é€šè¿‡é…ç½® menus è°ƒæ•´èœå•çš„é¡ºåºï¼Œå‚è€ƒã€é…ç½®èœå•ã€‘éƒ¨åˆ†çš„æ–‡æ¡£
        editor.config.menus = editor.config.menus.concat(menuKey)
        // é€‰æ‹©è¯­è¨€
        editor.config.lang = 'en'

        editor.i18next = window.i18next
        // editor.config.onblur = function (newHtml) {
        //     console.log('onblur', newHtml)
        // }
        // editor.config.onfocus = function (newHtml) {
        //     console.log('onfocus', newHtml)
        // }
        // editor.config.fontNames = [
        //     'å®‹ä½“',
        //     'å¾®è½¯é›…é»‘',
        // ]

        // é…ç½® server æ¥å£åœ°å€
        editor.config.uploadImgServer = '/upload-img'
        editor.config.uploadImgMaxSize = 2 * 1024 * 1024 // 2M
        editor.config.uploadImgMaxLength = 5 // ä¸€æ¬¡æœ€å¤šä¸Šä¼  5 ä¸ªå›¾ç‰‡
        editor.config.uploadImgParams = {
            token: 'xxxxx',
            x: 100
        }
        // editor.config.uploadImgParamsWithUrl = true // æ‹¼æ¥å‚æ•°åˆ°url
        editor.config.uploadFileName = 'your-custom-fileName'
        editor.config.uploadImgHeaders = {
            Accept: 'text/x-json',
            a: 100,
        }
        editor.config.uploadImgTimeout = 5 * 1000
        editor.config.uploadImgHooks = {
            // ä¸Šä¼ å›¾ç‰‡ä¹‹å‰
            before: function (xhr) {
                console.log(xhr)

                // å¯é˜»æ­¢å›¾ç‰‡ä¸Šä¼ 
                // return {
                //     prevent: true,
                //     msg: 'éœ€è¦æç¤ºç»™ç”¨æˆ·çš„é”™è¯¯ä¿¡æ¯'
                // }
            },
            // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›äº†ç»“æœï¼Œå›¾ç‰‡æ’å…¥å·²æˆåŠŸ
            success: function (xhr) {
                console.log('success', xhr)
            },
            // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›äº†ç»“æœï¼Œä½†å›¾ç‰‡æ’å…¥æ—¶å‡ºé”™äº†
            fail: function (xhr, editor, resData) {
                console.log('fail', resData)
            },
            // ä¸Šä¼ å›¾ç‰‡å‡ºé”™ï¼Œä¸€èˆ¬ä¸º http è¯·æ±‚çš„é”™è¯¯
            error: function (xhr, editor, resData) {
                console.log('error', xhr, resData)
            },
            // ä¸Šä¼ å›¾ç‰‡è¶…æ—¶
            timeout: function (xhr) {
                console.log('timeout')
            },
            // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›äº†ç»“æœï¼Œæƒ³è¦è‡ªå·±æŠŠå›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨ä¸­
            // ä¾‹å¦‚æœåŠ¡å™¨ç«¯è¿”å›çš„ä¸æ˜¯ { errno: 0, data: [...] } è¿™ç§æ ¼å¼ï¼Œå¯ä½¿ç”¨ customInsert
            customInsert: function (insertImgFn, result) {
                // result å³æœåŠ¡ç«¯è¿”å›çš„æ¥å£
                console.log('customInsert', result)

                // insertImgFn å¯æŠŠå›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨ï¼Œä¼ å…¥å›¾ç‰‡ src ï¼Œæ‰§è¡Œå‡½æ•°å³å¯
                insertImgFn(result.data[0])
            }
        }

        // å¿½ç•¥é»è´´çš„å›¾ç‰‡
        editor.config.pasteIgnoreImg = true

        // é…ç½®ç²˜è´´æ–‡æœ¬çš„å†…å®¹å¤„ç†
        editor.config.pasteTextHandle = function (pasteStr) {
            // å¯¹ç²˜è´´çš„æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œç„¶åè¿”å›å¤„ç†åçš„ç»“æœ
            return pasteStr + 'å·´æ‹‰å·´æ‹‰'
        }

        editor.config.customFontSize = [
            { value: '9px', text: '9' },
            { value: '10px', text: '10' },
            { value: '12px', text: '12' },
            { value: '14px', text: '14' },
            { value: '16px', text: '16' },
            { value: '20px', text: '20' },
            { value: '42px', text: '42' },
            { value: '66px', text: '66' },
        ]

        editor.config.fontNames = [
            'å¾®è½¯é›…é»‘',
            'å®‹ä½“'
        ]

        editor.config.colors = [
            '#000000',
            '#eeece0',
            '#1c487f',
            '#4d80bf',
            '#c24f4a',
            '#8baa4a',
            '#7b5ba1',
            '#46acc8',
            '#f9963b',
            '#ffffff'
        ]

        editor.config.lineHeights = ['1', '1.5', '1.6', '2', '2.5', '3']

        editor.config.placeholder = 'è¯·è¾“å…¥æ­£æ–‡'

        editor.config.emotions = [
            {
                title: 'emoji',  // tab çš„æ ‡é¢˜
                type: 'emoji', // 'emoji' / 'image'
                // emoji è¡¨æƒ…ï¼Œcontent æ˜¯ä¸€ä¸ªæ•°ç»„å³å¯
                content: 'ğŸ˜€ ğŸ˜ƒ ğŸ˜„ ğŸ˜ ğŸ˜† ğŸ˜… ğŸ˜‚ ğŸ˜Š ğŸ˜‡ ğŸ™‚ ğŸ™ƒ ğŸ˜‰ ğŸ˜“ ğŸ˜ª ğŸ˜´ ğŸ™„ ğŸ¤” ğŸ˜¬ ğŸ¤'.split(/\s/),
            }
        ]

        editor.config.linkCheck = function (text, link) {
            // ä»¥ä¸‹æƒ…å†µï¼Œè¯·ä¸‰é€‰ä¸€

            if (link.indexOf('https') != -1) return 'ä¸èƒ½æœ‰httpsçš„é“¾æ¥'

            // 1. è¿”å› true ï¼Œè¯´æ˜æ£€æŸ¥é€šè¿‡
            return true

            // // 2. è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯´æ˜æ£€æŸ¥æœªé€šè¿‡ï¼Œç¼–è¾‘å™¨ä¼šé˜»æ­¢é“¾æ¥æ’å…¥ã€‚ä¼š alert å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆå³è¿”å›çš„å­—ç¬¦ä¸²ï¼‰
            // return 'é“¾æ¥æœ‰ xxx é”™è¯¯'

            // 3. è¿”å› undefinedï¼ˆå³æ²¡æœ‰ä»»ä½•è¿”å›ï¼‰ï¼Œè¯´æ˜æ£€æŸ¥æœªé€šè¿‡ï¼Œç¼–è¾‘å™¨ä¼šé˜»æ­¢é“¾æ¥æ’å…¥ã€‚
            // æ­¤å¤„ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰æç¤ºé”™è¯¯ä¿¡æ¯ï¼Œè‡ªç”±å‘æŒ¥
        }

        editor.config.uploadImgShowBase64 = true

        editor.config.pasteFilterStyle = false

        // é…ç½® onchange å›è°ƒå‡½æ•°
        editor.config.onchange = function (newHtml) {
            console.log('change ä¹‹åæœ€æ–°çš„ html', newHtml)
        }
        // é…ç½®è§¦å‘ onchange çš„æ—¶é—´é¢‘ç‡ï¼Œé»˜è®¤ä¸º 200ms
        editor.config.onchangeTimeout = 500 // ä¿®æ”¹ä¸º 500ms

        editor.config.onblur = function (newHtml) {
            console.log('onblur', newHtml) // è·å–æœ€æ–°çš„ html å†…å®¹
        }
        editor.config.onfocus = function (newHtml) {
            console.log('onfocus', newHtml) // è·å–æœ€æ–°çš„ html å†…å®¹
        }

        // è§†é¢‘é€šç”¨ä»£ç 
        // <iframe frameborder="0" src="https://v.qq.com/txp/iframe/player.html?vid=n0020yrnly7" allowFullScreen="true"></iframe>

        editor.create()


        function setHtml(html) {
            if (!html) return editor.txt.html()
            editor.txt.html(html)
        }

        function setText(text) {
            if (!text) return editor.txt.text()
            editor.txt.text(text)
        }

        function appendT() {
            editor.txt.append('<p>è¿½åŠ çš„å†…å®¹</p>')
        }

        function clear() {
            editor.txt.clean()
        }

    </script>
</body>

</html>