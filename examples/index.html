<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wangEditor example</title>
    <style>
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/19.7.0/i18next.min.js"
        integrity="sha512-n4K5cTN3agoN7ex8/UyiV83vJsVApziWHYEAaDIJ71o59tHYcYkddYzg55x/6LPs1R5db+f5pE6RmpO45L0pHA=="
        crossorigin="anonymous"></script>
</head>

<body>
    <p>
        wangEditor demo
    </p>
    <div id="div1">
        <p>欢迎使用 <b>wangEditor</b> 富文本编辑器</p>
        <p>
            <img src="//www.baidu.com/img/flexible/logo/pc/result@2.png" />
        </p>
    </div>

    <button onclick="setHtml('<div>设置的内容</div>')">设置内容</button>
    <button onclick="setText('设置的文本')">设置文本</button>
    <button onclick="appendT()">追加内容</button>
    <button onclick="clear()">清空</button>

    <script src="../dist/wangEditor.js"></script>
    <script>

        (function () {
            console.log('i18next', window.i18next)
        })()

        const E = window.wangEditor
        const editor = new E('#div1')

        const { $ } = E
        const { BtnMenu, DropListMenu, PanelMenu, DropList, Panel, Tooltip } = E.menuConstructors

        // 第一，菜单 class ，Button 菜单继承 BtnMenu class
        class AlertMenu extends BtnMenu {
            constructor(editor) {
                const $elem = E.$(
                    `<div class="w-e-menu">
                <button>alert</button>
            </div>`
                )
                super($elem, editor)
            }
            // 菜单点击事件
            clickHandler() {
                // 做任何你想做的事情
                // 可参考【常用 API】文档，来操作编辑器

                alert('hello world')
            }
            // 菜单是否被激活（如果不需要，这个函数可以空着）
            // 1. 激活是什么？光标放在一段加粗、下划线的文本时，菜单栏里的 B 和 U 被激活，如下图
            // 2. 什么时候执行这个函数？每次编辑器区域的选区变化（如鼠标操作、键盘操作等），都会触发各个菜单的 tryChangeActive 函数，重新计算菜单的激活状态
            tryChangeActive() {
                // 激活菜单
                // 1. 菜单 DOM 节点会增加一个 .w-e-active 的 css class
                // 2. this.this.isActive === true
                this.active()

                // // 取消激活菜单
                // // 1. 菜单 DOM 节点会删掉 .w-e-active
                // // 2. this.this.isActive === false
                // this.unActive()
            }
        }


        // 注册菜单
        const menuKey = 'alertMenuKey' // 菜单 key ，各个菜单不能重复
        editor.menus.extend('alertMenuKey', AlertMenu)

        // 将菜单加入到 editor.config.menus 中
        // 也可以通过配置 menus 调整菜单的顺序，参考【配置菜单】部分的文档
        editor.config.menus = editor.config.menus.concat(menuKey)
        // 选择语言
        editor.config.lang = 'en'

        editor.i18next = window.i18next
        // editor.config.onblur = function (newHtml) {
        //     console.log('onblur', newHtml)
        // }
        // editor.config.onfocus = function (newHtml) {
        //     console.log('onfocus', newHtml)
        // }
        // editor.config.fontNames = [
        //     '宋体',
        //     '微软雅黑',
        // ]

        // 配置 server 接口地址
        editor.config.uploadImgServer = '/upload-img'
        editor.config.uploadImgMaxSize = 2 * 1024 * 1024 // 2M
        editor.config.uploadImgMaxLength = 5 // 一次最多上传 5 个图片
        editor.config.uploadImgParams = {
            token: 'xxxxx',
            x: 100
        }
        // editor.config.uploadImgParamsWithUrl = true // 拼接参数到url
        editor.config.uploadFileName = 'your-custom-fileName'
        editor.config.uploadImgHeaders = {
            Accept: 'text/x-json',
            a: 100,
        }
        editor.config.uploadImgTimeout = 5 * 1000
        editor.config.uploadImgHooks = {
            // 上传图片之前
            before: function (xhr) {
                console.log(xhr)

                // 可阻止图片上传
                // return {
                //     prevent: true,
                //     msg: '需要提示给用户的错误信息'
                // }
            },
            // 图片上传并返回了结果，图片插入已成功
            success: function (xhr) {
                console.log('success', xhr)
            },
            // 图片上传并返回了结果，但图片插入时出错了
            fail: function (xhr, editor, resData) {
                console.log('fail', resData)
            },
            // 上传图片出错，一般为 http 请求的错误
            error: function (xhr, editor, resData) {
                console.log('error', xhr, resData)
            },
            // 上传图片超时
            timeout: function (xhr) {
                console.log('timeout')
            },
            // 图片上传并返回了结果，想要自己把图片插入到编辑器中
            // 例如服务器端返回的不是 { errno: 0, data: [...] } 这种格式，可使用 customInsert
            customInsert: function (insertImgFn, result) {
                // result 即服务端返回的接口
                console.log('customInsert', result)

                // insertImgFn 可把图片插入到编辑器，传入图片 src ，执行函数即可
                insertImgFn(result.data[0])
            }
        }

        // 忽略黏贴的图片
        editor.config.pasteIgnoreImg = true

        // 配置粘贴文本的内容处理
        editor.config.pasteTextHandle = function (pasteStr) {
            // 对粘贴的文本进行处理，然后返回处理后的结果
            return pasteStr + '巴拉巴拉'
        }

        editor.config.customFontSize = [
            { value: '9px', text: '9' },
            { value: '10px', text: '10' },
            { value: '12px', text: '12' },
            { value: '14px', text: '14' },
            { value: '16px', text: '16' },
            { value: '20px', text: '20' },
            { value: '42px', text: '42' },
            { value: '66px', text: '66' },
        ]

        editor.config.fontNames = [
            '微软雅黑',
            '宋体'
        ]

        editor.config.colors = [
            '#000000',
            '#eeece0',
            '#1c487f',
            '#4d80bf',
            '#c24f4a',
            '#8baa4a',
            '#7b5ba1',
            '#46acc8',
            '#f9963b',
            '#ffffff'
        ]

        editor.config.lineHeights = ['1', '1.5', '1.6', '2', '2.5', '3']

        editor.config.placeholder = '请输入正文'

        editor.config.emotions = [
            {
                title: 'emoji',  // tab 的标题
                type: 'emoji', // 'emoji' / 'image'
                // emoji 表情，content 是一个数组即可
                content: '😀 😃 😄 😁 😆 😅 😂 😊 😇 🙂 🙃 😉 😓 😪 😴 🙄 🤔 😬 🤐'.split(/\s/),
            }
        ]

        editor.config.linkCheck = function (text, link) {
            // 以下情况，请三选一

            if (link.indexOf('https') != -1) return '不能有https的链接'

            // 1. 返回 true ，说明检查通过
            return true

            // // 2. 返回一个字符串，说明检查未通过，编辑器会阻止链接插入。会 alert 出错误信息（即返回的字符串）
            // return '链接有 xxx 错误'

            // 3. 返回 undefined（即没有任何返回），说明检查未通过，编辑器会阻止链接插入。
            // 此处，你可以自定义提示错误信息，自由发挥
        }

        editor.config.uploadImgShowBase64 = true

        editor.config.pasteFilterStyle = false

        // 配置 onchange 回调函数
        editor.config.onchange = function (newHtml) {
            console.log('change 之后最新的 html', newHtml)
        }
        // 配置触发 onchange 的时间频率，默认为 200ms
        editor.config.onchangeTimeout = 500 // 修改为 500ms

        editor.config.onblur = function (newHtml) {
            console.log('onblur', newHtml) // 获取最新的 html 内容
        }
        editor.config.onfocus = function (newHtml) {
            console.log('onfocus', newHtml) // 获取最新的 html 内容
        }

        // 视频通用代码
        // <iframe frameborder="0" src="https://v.qq.com/txp/iframe/player.html?vid=n0020yrnly7" allowFullScreen="true"></iframe>

        editor.create()


        function setHtml(html) {
            if (!html) return editor.txt.html()
            editor.txt.html(html)
        }

        function setText(text) {
            if (!text) return editor.txt.text()
            editor.txt.text(text)
        }

        function appendT() {
            editor.txt.append('<p>追加的内容</p>')
        }

        function clear() {
            editor.txt.clean()
        }

    </script>
</body>

</html>